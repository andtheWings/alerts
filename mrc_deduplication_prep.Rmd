---
title: "1 Prepping Datasets for Deduplication and Merging"
author: "Daniel P. Hall Riggins, MD"
date: "9/11/2021"
output: html_document
---

```{r message=FALSE, warning=FALSE}
library(readxl)
library(RMariaDB)
library(tidyverse)
```

"MatchingtoMEdata" and "Rectified_FHSP_CC_20201102" do not need any prep

```{r message=FALSE, warning=FALSE}
history_raw <- read_xlsx("mrc_data/encounter history.xlsx")
FHP_raw <- read_xlsx("mrc_data/FHPMatchedtoEMRMatchedtoChante_reduced.xlsx", na = "NULL")
```

```{r}
con <- dbConnect(MariaDB(),
                 dbname = 'mrc_data',
                 host = '127.0.0.1',
                 port = 3306,
                 user = 'root')
```


```{r}
history_people <- history_raw %>%
    # 145490 observations
    #distinct() %>%
    # No change
    select(
        person_id, cmrn_id, rin_cc, BIRTH_DT_TM, sex_cd, race, ethnicity
    ) %>%
    distinct() %>%
    # 4766 observations
    mutate(
        origin = "encounter_history.xlsx"
    )

history_encounters <- history_raw %>%
    # 145490 observations
    #distinct() %>%
    # No change
    select(
        !c(BIRTH_DT_TM, sex_cd, race, ethnicity)
    ) %>%
    #distinct() %>%
    # No change
    mutate(
        origin = "encounter_history.xlsx"
    )

FHP_people <- FHP_raw %>%
    # 86576 rows
    distinct() %>%
    # 44346 rows
    select(
        person_id, cmrn_id, rin_cc, NAME_FIRST, NAME_LAST, BIRTH_DT_TM, sex_cd, race, ethnicity
    ) %>%
    distinct() %>%
    # 4768 rows
    mutate(
        origin = "FHPMatchedtoEMRMatchedtoChante_reduced.xlsx"
    )


FHP_encounters <- FHP_raw %>%
    # 86576 rows
    distinct() %>%
    # 44346 rows
    select(
        !c(NAME_FIRST, NAME_LAST, BIRTH_DT_TM, sex_cd, race, ethnicity)
    ) %>%
    #distinct() %>%
    # no change
    mutate(
        origin = "FHPMatchedtoEMRMatchedtoChante_reduced.xlsx"
    )
```






